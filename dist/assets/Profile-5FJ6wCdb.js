import{u as N,j as e}from"./index-CVmCnHMs.js";import{r as o}from"./vendor-seEwQDT5.js";import{U as h,c as v,K as w,o as _,e as C,N as S}from"./ui-g5MN1jGh.js";import"./supabase-BZoxqOT3.js";import"./router-BnLuTL28.js";const M=()=>{const{user:s,supabase:i}=N(),[r,m]=o.useState({}),[g,b]=o.useState(!0),[x,u]=o.useState(!1),[y,c]=o.useState(!1),[p,d]=o.useState("");o.useEffect(()=>{s&&(async()=>{var l;try{const{data:t,error:f}=await i.from("user_profiles").select("*").eq("user_id",s==null?void 0:s.id).maybeSingle();if(f)throw f;m(t||{full_name:((l=s==null?void 0:s.user_metadata)==null?void 0:l.full_name)||"",country:"IT"})}catch(t){console.error("Error loading profile:",t),d("Errore nel caricamento del profilo")}finally{b(!1)}})()},[s,i]);const a=n=>{m({...r,[n.target.name]:n.target.value})},j=async n=>{n.preventDefault(),u(!0),d(""),c(!1);try{const l={user_id:s==null?void 0:s.id,full_name:r.full_name,phone:r.phone,address:r.address,city:r.city,postal_code:r.postal_code,country:r.country||"IT"},{error:t}=await i.from("user_profiles").upsert(l,{onConflict:"user_id"});if(t)throw t;c(!0),setTimeout(()=>c(!1),3e3)}catch(l){console.error("Error saving profile:",l),d("Errore nel salvataggio del profilo")}finally{u(!1)}};return g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Caricamento profilo..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2 flex items-center",children:[e.jsx(h,{className:"h-8 w-8 mr-3"}),"Il Mio Profilo"]}),e.jsx("p",{className:"text-gray-600",children:"Gestisci le tue informazioni personali"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"mb-8 pb-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Informazioni Account"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(v,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium text-gray-900",children:s==null?void 0:s.email})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(h,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Membro dal"}),e.jsx("p",{className:"font-medium text-gray-900",children:s!=null&&s.created_at?new Date(s.created_at).toLocaleDateString("it-IT"):"N/A"})]})]})]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Informazioni Personali"}),e.jsx(w,{className:"h-5 w-5 text-gray-400"})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("p",{className:"text-red-700",children:p})}),y&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-center space-x-2",children:[e.jsx(_,{className:"h-5 w-5 text-green-500"}),e.jsx("p",{className:"text-green-700",children:"Profilo aggiornato con successo!"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo"}),e.jsx("input",{type:"text",id:"full_name",name:"full_name",value:r.full_name||"",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mario Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefono"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:r.phone||"",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+39 123 456 7890"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),"Indirizzo"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-2",children:"Via e Numero Civico"}),e.jsx("input",{type:"text",id:"address",name:"address",value:r.address||"",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Via Roma 123"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-2",children:"Citt√†"}),e.jsx("input",{type:"text",id:"city",name:"city",value:r.city||"",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Milano"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700 mb-2",children:"CAP"}),e.jsx("input",{type:"text",id:"postal_code",name:"postal_code",value:r.postal_code||"",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"20121"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-2",children:"Paese"}),e.jsx("input",{type:"text",id:"country",name:"country",value:r.country||"IT",onChange:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"IT"})]})]})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white py-3 px-4 rounded-lg font-semibold transition-colors duration-200 flex items-center justify-center space-x-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Salvataggio..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-5 w-5"}),e.jsx("span",{children:"Salva Modifiche"})]})})]})]})]})})};export{M as default};
