import{u as Q,j as e}from"./index-CNRBJ32G.js";import{r as l}from"./vendor-seEwQDT5.js";import{c as V}from"./router-BnLuTL28.js";import{b as N,O as W,L as X,Q as Y,G as J,j as K,m as Z,V as ee,t as se,X as te,v as ae,W as le,Y as re,x as ie,u as E}from"./ui-CrNHFUv9.js";import"./supabase-BZoxqOT3.js";const me=()=>{const{signOut:z,user:m,supabase:v}=Q(),L=V(),[r,y]=l.useState([]),[h,f]=l.useState(!0),[n,D]=l.useState(""),[c,T]=l.useState("all");l.useState("all");const[w,u]=l.useState(""),[k,g]=l.useState(null),[d,o]=l.useState(""),[p,_]=l.useState(!1),[j,P]=l.useState(null),x=[{value:"processing",label:"In Elaborazione",color:"bg-blue-100 text-blue-800"},{value:"confirmed",label:"Confermato",color:"bg-blue-100 text-blue-800"},{value:"printing",label:"In Stampa",color:"bg-yellow-100 text-yellow-800"},{value:"completed",label:"Completato",color:"bg-green-100 text-green-800"},{value:"shipped",label:"Spedito",color:"bg-purple-100 text-purple-800"},{value:"delivered",label:"Consegnato",color:"bg-green-100 text-green-800"},{value:"canceled",label:"Annullato",color:"bg-red-100 text-red-800"}],S=async()=>{try{f(!0),u("");const{data:s,error:t}=await v.from("orders").select(`
          *,
          order_items (
            product_name,
            quantity,
            unit_price,
            selected_color,
            selected_size,
            size_dimensions,
            customer_note
          )
        `).order("created_at",{ascending:!1});if(t)throw t;y(s||[])}catch(s){u("Errore nel caricamento degli ordini"),console.error("Error loading orders:",s)}finally{f(!1)}},q=async(s,t)=>{try{_(!0);const{error:a}=await v.from("orders").update({order_status:t,updated_at:new Date().toISOString()}).eq("id",s);if(a)throw a;y(r.map(i=>i.id===s?{...i,order_status:t,updated_at:new Date().toISOString()}:i)),g(null),o("")}catch(a){console.error("Error updating order status:",a),u("Errore nell'aggiornamento dello stato dell'ordine")}finally{_(!1)}};l.useEffect(()=>{S()},[]);const A=s=>{const t=x.find(a=>a.value===s);return(t==null?void 0:t.color)||"bg-gray-100 text-gray-800"},F=s=>{const t=x.find(a=>a.value===s);return(t==null?void 0:t.label)||s},b=s=>new Date(s).toLocaleDateString("it-IT",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),C=r.filter(s=>{const t=s.customer_name.toLowerCase().includes(n.toLowerCase())||s.customer_email.toLowerCase().includes(n.toLowerCase())||s.id.toLowerCase().includes(n.toLowerCase()),a=c==="all"||s.order_status===c;return t&&a}),I=r.reduce((s,t)=>s+t.total_amount,0),R=r.length,U=r.filter(s=>["processing","printing"].includes(s.order_status)).length,$=r.filter(s=>s.order_status==="completed").length,G=async()=>{try{await z(),L("/admin/login")}catch(s){console.error("Error during logout:",s)}},H=(s,t)=>{g(s),o(t)},O=()=>{g(null),o("")},B=s=>{var t;d&&d!==((t=r.find(a=>a.id===s))==null?void 0:t.order_status)?q(s,d):O()},M=s=>{P(j===s?null:s)};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(N,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("a",{href:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Home"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Benvenuto, ",m==null?void 0:m.email]}),e.jsxs("button",{onClick:G,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Esci"})]})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ordini Totali"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:R})]}),e.jsx(N,{className:"h-8 w-8 text-blue-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ricavi Totali"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["€",I.toFixed(2)]})]}),e.jsx(Y,{className:"h-8 w-8 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"In Lavorazione"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:U})]}),e.jsx(J,{className:"h-8 w-8 text-orange-600"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Completati"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:$})]}),e.jsx(K,{className:"h-8 w-8 text-purple-600"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Gestione Ordini"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Cerca ordini...",value:n,onChange:s=>D(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:c,onChange:s=>T(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tutti gli stati"}),x.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))]}),e.jsxs("button",{onClick:S,disabled:h,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg font-medium transition-colors",children:[e.jsx(ee,{className:`h-4 w-4 ${h?"animate-spin":""}`}),e.jsx("span",{children:"Aggiorna"})]})]})]})}),w&&e.jsx("div",{className:"px-6 py-4 bg-red-50 border-b border-red-200",children:e.jsx("p",{className:"text-red-700",children:w})}),h?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Caricamento ordini..."})]}):e.jsxs("div",{className:"divide-y divide-gray-200",children:[C.map(s=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Ordine #",s.id.slice(0,8)]}),e.jsx("p",{className:"text-sm text-gray-600",children:b(s.created_at)})]}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["€",s.total_amount.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[k===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("select",{value:d,onChange:t=>o(t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p,children:x.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("button",{onClick:()=>B(s.id),disabled:p,className:"text-green-600 hover:text-green-700 disabled:text-green-400",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:O,disabled:p,className:"text-gray-600 hover:text-gray-700 disabled:text-gray-400",children:e.jsx(te,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${A(s.order_status)}`,children:F(s.order_status)}),e.jsx("button",{onClick:()=>H(s.id,s.order_status),className:"text-blue-600 hover:text-blue-700",children:e.jsx(ae,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:()=>M(s.id),className:"text-gray-600 hover:text-gray-700",children:j===s.id?e.jsx(le,{className:"h-5 w-5"}):e.jsx(re,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Cliente"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_email}),s.customer_phone&&e.jsx("p",{className:"text-sm text-gray-600",children:s.customer_phone})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-2 flex items-center",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Indirizzo di Spedizione"]}),s.shipping_address?e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:s.customer_name}),e.jsx("p",{children:s.shipping_address.address}),e.jsxs("p",{children:[s.shipping_address.postalCode," ",s.shipping_address.city]}),e.jsx("p",{children:s.shipping_address.country})]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"Nessun indirizzo fornito"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Prodotti"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.order_items.slice(0,2).map((t,a)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{children:[t.quantity,"x ",t.product_name]}),t.selected_color&&e.jsxs("span",{className:"ml-1",children:["(",t.selected_color,")"]}),t.customer_note&&e.jsx("button",{onClick:i=>{i.stopPropagation(),alert(`Nota cliente:

${t.customer_note}`)},className:"ml-2 text-blue-600 hover:text-blue-800",title:"Nota cliente",children:e.jsx(E,{className:"h-4 w-4"})})]},a)),s.order_items.length>2&&e.jsxs("div",{className:"text-gray-500",children:["+",s.order_items.length-2," altri prodotti"]})]})]})]}),j===s.id&&e.jsxs("div",{className:"border-t border-gray-200 pt-4 mt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Dettagli Completi"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Tutti i Prodotti"}),e.jsx("div",{className:"space-y-2",children:s.order_items.map((t,a)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:t.product_name}),t.selected_color&&e.jsxs("span",{className:"text-gray-600 ml-2",children:["(",t.selected_color,")"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[t.quantity," x €",t.unit_price.toFixed(2)]}),t.customer_note&&e.jsx("button",{onClick:i=>{i.stopPropagation(),alert(`Nota cliente:

${t.customer_note}`)},className:"text-blue-600 hover:text-blue-800 mt-1",title:"Nota cliente",children:e.jsx(E,{className:"h-4 w-4"})})]})]},a))}),e.jsxs("div",{className:"border-t border-gray-200 mt-3 pt-3 flex justify-between items-center font-semibold",children:[e.jsx("span",{children:"Totale Ordine:"}),e.jsxs("span",{children:["€",s.total_amount.toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:"Informazioni Ordine"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ID Ordine:"}),e.jsx("span",{className:"ml-2 font-mono",children:s.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Stato Pagamento:"}),e.jsx("span",{className:"ml-2 capitalize",children:s.payment_status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Creato:"}),e.jsx("span",{className:"ml-2",children:b(s.created_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Aggiornato:"}),e.jsx("span",{className:"ml-2",children:b(s.updated_at)})]})]})]})]})]},s.id)),C.length===0&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(N,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nessun ordine trovato"}),e.jsx("p",{className:"text-gray-600",children:n||c!=="all"?"Prova a modificare i filtri di ricerca":"Non ci sono ordini da visualizzare"})]})]})]})]})]})};export{me as default};
