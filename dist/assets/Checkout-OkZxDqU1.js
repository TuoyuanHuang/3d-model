import{u as I,a as R,j as e}from"./index-uCfaxT6h.js";import{r as i}from"./vendor-seEwQDT5.js";import{c as z,L as j}from"./router-BnLuTL28.js";import{C as T}from"./CheckoutForm-DUYFQnv2.js";import{b as y,x as A,y as P,U as D,z as f,B as V}from"./ui-CrNHFUv9.js";import"./supabase-BZoxqOT3.js";import"./stripe-rSCYVjF0.js";const m=100,N=9.9,v=4.9,G=()=>{var b;const{user:t,session:x}=I(),{items:a,totalAmount:o,clearCart:C}=R(),n=z(),[c,u]=i.useState("standard"),[h,w]=i.useState(!1),[r,k]=i.useState({name:((b=t==null?void 0:t.user_metadata)==null?void 0:b.full_name)||"",email:(t==null?void 0:t.email)||"",phone:"",address:"",city:"",postalCode:""}),[p,E]=i.useState(!1),d=c==="express"?o>=m?0:N:v,g=o+d;i.useEffect(()=>{a.length===0&&n("/carrello")},[a,n]),i.useEffect(()=>{const s=r.name.trim()!==""&&r.email.trim()!=="";E(s)},[r]);const l=s=>{k({...r,[s.target.name]:s.target.value})},S=async s=>{try{await C(),n("/ordini")}catch(_){console.error("Error clearing cart:",_),n(`/ordini/${s}`)}},F=s=>{console.error("Payment error:",s)};return a.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Carrello Vuoto"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Aggiungi prodotti al carrello per procedere al checkout"}),e.jsx("button",{onClick:()=>n("/catalogo"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium",children:"Vai al Catalogo"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(y,{className:"h-5 w-5 mr-2"}),"Riepilogo Ordine"]}),e.jsx("div",{className:"space-y-4 mb-6",children:a.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.product_name}),e.jsxs("div",{className:"flex flex-wrap items-center",children:[e.jsxs("span",{children:["Quantità: ",s.quantity]}),s.selected_color&&e.jsxs("span",{className:"ml-4",children:["Colore: ",s.selected_color]}),s.customer_note&&e.jsx("div",{className:"ml-4 flex items-center text-blue-600",children:e.jsx("span",{className:"cursor-pointer hover:underline",onClick:()=>alert(`Nota: ${s.customer_note}`),children:"Nota cliente"})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["€",s.unit_price.toFixed(2)]}),s.quantity>1&&e.jsxs("p",{className:"text-sm text-gray-600",children:["€",(s.unit_price*s.quantity).toFixed(2)," totale"]})]})]},s.id))}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotale"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["€",o.toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 pb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Metodo di Spedizione"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"standard",checked:c==="standard",onChange:()=>u("standard"),className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Spedizione Standard (5-7 giorni lavorativi)"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["€",v.toFixed(2)]})]})]}),e.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"express",checked:c==="express",onChange:()=>u("express"),className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Spedizione Express (3-5 giorni)"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o>=m?"Gratuita":`€${N.toFixed(2)}`,o<m&&` (gratuita per ordini sopra €${m})`]})]})]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:c==="express"?"Express Delivery (3-5 giorni)":"Standard Delivery (5-7 giorni)"}),e.jsx("span",{className:"font-medium text-gray-900",children:d===0?"Gratuita":`€${d.toFixed(2)}`})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Totale"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:["€",g.toFixed(2)]})]})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(P,{className:"h-5 w-5 mr-2"}),"Pagamento"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Informazioni Cliente"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:r.name,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mario Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",id:"email",name:"email",required:!0,value:r.email,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"mario@email.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefono"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:r.phone,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+39 123 456 7890"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Indirizzo"}),e.jsx("input",{type:"text",id:"address",name:"address",value:r.address,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Via Roma 123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"Città"}),e.jsx("input",{type:"text",id:"city",name:"city",value:r.city,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Milano"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"CAP"}),e.jsx("input",{type:"text",id:"postalCode",name:"postalCode",value:r.postalCode,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"20121"})]})]})]}),e.jsxs("div",{className:"mb-6 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"terms",name:"terms",type:"checkbox",checked:h,onChange:s=>w(s.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500",required:!0})}),e.jsx("div",{className:"ml-3 text-sm",children:e.jsxs("label",{htmlFor:"terms",className:"font-medium text-gray-700",children:["Ho letto e accetto i ",e.jsx(j,{to:"/terms-and-conditions",className:"text-blue-600 hover:text-blue-800 underline",target:"_blank",children:"Termini e Condizioni"})," e la ",e.jsx(j,{to:"/privacy-policy",className:"text-blue-600 hover:text-blue-800 underline",target:"_blank",children:"Privacy Policy"})]})})]}),!h&&p&&e.jsxs("p",{className:"mt-2 text-sm text-red-600 flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),"È necessario accettare i termini e condizioni per procedere"]})]}),p?e.jsx(e.Fragment,{children:h?e.jsx(T,{amount:g,productName:`Ordine carrello (${a.length} ${a.length===1?"prodotto":"prodotti"})`,productId:"cart-order",cartItems:a,customerInfo:r,deliveryMethod:c,deliveryFee:d,authToken:x==null?void 0:x.access_token,onSuccess:S,onError:F}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-yellow-800 font-medium flex items-center",children:[e.jsx(f,{className:"h-5 w-5 mr-2"}),"Accetta i termini e condizioni per procedere al pagamento"]})})}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Completa le informazioni obbligatorie per procedere al pagamento"}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:"I campi Nome e Email sono obbligatori"})]}),e.jsxs("div",{className:"mt-6 flex items-center text-sm text-gray-500",children:[e.jsx(V,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("p",{children:"I tuoi dati di pagamento sono protetti e crittografati"})]})]})]})})})};export{G as default};
