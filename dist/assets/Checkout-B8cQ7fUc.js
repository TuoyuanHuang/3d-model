import{u as S,a as F,j as e}from"./index-tE5lHzQN.js";import{r as d}from"./vendor-seEwQDT5.js";import{C as k}from"./CheckoutForm-CYmwPTz0.js";import{c as _}from"./router-BnLuTL28.js";import{b as g,x as R,y as I,U as D}from"./ui-Crfp5dSv.js";import"./supabase-BZoxqOT3.js";import"./stripe-rSCYVjF0.js";const m=100,b=9.9,y=4.9,q=()=>{var p;const{user:t,session:x}=S(),{items:r,totalAmount:o,clearCart:j}=F(),i=_(),[n,h]=d.useState("standard"),[a,f]=d.useState({name:((p=t==null?void 0:t.user_metadata)==null?void 0:p.full_name)||"",email:(t==null?void 0:t.email)||"",phone:"",address:"",city:"",postalCode:""}),[N,v]=d.useState(!1),c=n==="express"?o>=m?0:b:y,u=o+c;d.useEffect(()=>{r.length===0&&i("/carrello")},[r,i]),d.useEffect(()=>{const s=a.name.trim()!==""&&a.email.trim()!=="";v(s)},[a]);const l=s=>{f({...a,[s.target.name]:s.target.value})},C=async s=>{try{await j(),i(`/ordini/${s}`)}catch(E){console.error("Error clearing cart:",E),i(`/ordini/${s}`)}},w=s=>{console.error("Payment error:",s)};return r.length===0?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Carrello Vuoto"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Aggiungi prodotti al carrello per procedere al checkout"}),e.jsx("button",{onClick:()=>i("/catalogo"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium",children:"Vai al Catalogo"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(g,{className:"h-5 w-5 mr-2"}),"Riepilogo Ordine"]}),e.jsx("div",{className:"space-y-4 mb-6",children:r.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.product_name}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{children:["Quantità: ",s.quantity]}),s.selected_color&&e.jsxs("span",{className:"ml-4",children:["Colore: ",s.selected_color]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["€",s.unit_price.toFixed(2)]}),s.quantity>1&&e.jsxs("p",{className:"text-sm text-gray-600",children:["€",(s.unit_price*s.quantity).toFixed(2)," totale"]})]})]},s.id))}),e.jsx("div",{className:"border-t border-gray-200 pt-4",children:e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotale"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["€",o.toFixed(2)]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 pb-2",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Metodo di Spedizione"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"standard",checked:n==="standard",onChange:()=>h("standard"),className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Spedizione Standard (5-7 giorni)"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["€",y.toFixed(2)]})]})]}),e.jsxs("label",{className:"flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"express",checked:n==="express",onChange:()=>h("express"),className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Spedizione Express (3-5 giorni)"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o>=m?"Gratuita":`€${b.toFixed(2)}`,o<m&&` (gratuita per ordini sopra €${m})`]})]})]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:n==="express"?"Express Delivery (3-5 giorni)":"Standard Delivery (5-7 giorni)"}),e.jsx("span",{className:"font-medium text-gray-900",children:c===0?"Gratuita":`€${c.toFixed(2)}`})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Totale"}),e.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:["€",u.toFixed(2)]})]})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Pagamento"]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Informazioni Cliente"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",id:"name",name:"name",required:!0,value:a.name,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Mario Rossi"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",id:"email",name:"email",required:!0,value:a.email,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"mario@email.com"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefono"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:a.phone,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+39 123 456 7890"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Indirizzo"}),e.jsx("input",{type:"text",id:"address",name:"address",value:a.address,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Via Roma 123"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"Città"}),e.jsx("input",{type:"text",id:"city",name:"city",value:a.city,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Milano"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postalCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"CAP"}),e.jsx("input",{type:"text",id:"postalCode",name:"postalCode",value:a.postalCode,onChange:l,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"20121"})]})]})]}),N?e.jsx(k,{amount:u,productName:`Ordine carrello (${r.length} ${r.length===1?"prodotto":"prodotti"})`,productId:"cart-order",cartItems:r,customerInfo:a,deliveryMethod:n,deliveryFee:c,authToken:x==null?void 0:x.access_token,onSuccess:C,onError:w}):e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Completa le informazioni obbligatorie per procedere al pagamento"}),e.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:"I campi Nome e Email sono obbligatori"})]})]})]})})})};export{q as default};
